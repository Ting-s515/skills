# 範例：不重複通知（Distinct）— 查表判斷 + 單層迴圈

## 優化前（模糊描述）

```
先查有沒有發過，發過就不發了。
沒發過的話就從裡面找一筆還沒過期的發出去，然後記錄起來。
```

## 優化後（結構化描述）

**比對條件：** 主類別（`MainCategory`）+ 次類別（`SubCategory`）+ 告警編號（`AlertId`）

**處理流程：**

1. 查詢主類別、次類別與告警編號皆相符的告警資料，排除 `SendDeadline` 小於當前主機時間的資料（`SendDeadline` 為 `NULL` 視為無截止時間限制，不排除），符合條件的資料依 pk `Id` 由小到大排序
2. 以主類別（`MainCategory`）+ 次類別（`SubCategory`）+ 告警編號（`AlertId`）查詢標記表（已發送記錄表），確認是否已有發送記錄
3. **有記錄：** 不加入待發送清單，該告警已通知過
4. **無記錄：** 逐筆遍歷該批次資料，檢查截止時間（`SendDeadline`）是否已過：
   - **未過期：** 將該筆資料加入待發送清單，寫入標記表標記該告警已通知，結束遍歷
   - **已過期：** 繼續遍歷下一筆，直到找到符合條件的資料或遍歷完該批次所有資料

## 展示重點

| 項目 | 說明 |
|------|------|
| 複雜度 | 中（查表判斷 + 單層迴圈） |
| 優化要點 | 粗體標記分支、迴圈提前退出、無符合結果處理 |
